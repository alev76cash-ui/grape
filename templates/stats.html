{% extends "base.html" %}

{% block title %}üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1 class="display-5 fw-bold text-dark">
            <i class="fas fa-chart-bar me-2 text-primary"></i>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        </h1>
        <p class="lead text-dark">–û–±–∑–æ—Ä–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —Å–æ—Ä—Ç–∞–º –≤–∏–Ω–æ–≥—Ä–∞–¥–∞</p>
    </div>
    <div class="col-md-4 text-end">
        <div class="d-flex gap-2 justify-content-end">
            <a href="{{ url_for('admin_home') }}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left me-2"></i>–ù–∞–∑–∞–¥
            </a>
        </div>
    </div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white shadow-sm">
            <div class="card-body text-center">
                <h2 class="display-6 fw-bold">{{ total }}</h2>
                <p class="mb-0">–í—Å–µ–≥–æ —Å–æ—Ä—Ç–æ–≤</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white shadow-sm">
            <div class="card-body text-center">
                <h2 class="display-6 fw-bold">{{ purpose_stats|length }}</h2>
                <p class="mb-0">–ö–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-info text-white shadow-sm">
            <div class="card-body text-center">
                <h2 class="display-6 fw-bold">{{ color_stats|length }}</h2>
                <p class="mb-0">–¶–≤–µ—Ç–æ–≤ —è–≥–æ–¥</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white shadow-sm">
            <div class="card-body text-center">
                <h2 class="display-6 fw-bold">{{ activity_stats|length }}</h2>
                <p class="mb-0">–î–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è–º -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="fas fa-wine-glass-alt me-2 text-primary"></i>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é
                </h5>
            </div>
            <div class="card-body">
                {% if purpose_stats %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</th>
                                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for stat in purpose_stats %}
                            <tr>
                                <td>{{ stat.purpose }}</td>
                                <td>{{ stat.count }}</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="progress flex-grow-1 me-2" style="height: 8px;">
                                            <div class="progress-bar bg-primary"
                                                 style="width: {{ (stat.count / total * 100)|round(1) }}%">
                                            </div>
                                        </div>
                                        <span>{{ (stat.count / total * 100)|round(1) }}%</span>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-wine-glass-alt fa-3x text-muted mb-3"></i>
                    <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è—Ö</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ü–≤–µ—Ç–∞–º -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="fas fa-palette me-2 text-success"></i>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ü–≤–µ—Ç—É —è–≥–æ–¥
                </h5>
            </div>
            <div class="card-body">
                {% if color_stats %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–¶–≤–µ—Ç</th>
                                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for stat in color_stats %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="color-indicator me-2"
                                             style="width: 16px; height: 16px; background-color: {{ get_color_code(stat.berry_color) }}; border-radius: 50%;"></div>
                                        {{ stat.berry_color }}
                                    </div>
                                </td>
                                <td>{{ stat.count }}</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="progress flex-grow-1 me-2" style="height: 8px;">
                                            <div class="progress-bar bg-success"
                                                 style="width: {{ (stat.count / total * 100)|round(1) }}%">
                                            </div>
                                        </div>
                                        <span>{{ (stat.count / total * 100)|round(1) }}%</span>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-palette fa-3x text-muted mb-3"></i>
                    <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ü–≤–µ—Ç–∞—Ö —è–≥–æ–¥</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–æ—Ä–æ–∑–æ—Å—Ç–æ–π–∫–æ—Å—Ç–∏ -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="fas fa-snowflake me-2 text-info"></i>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –º–æ—Ä–æ–∑–æ—Å—Ç–æ–π–∫–æ—Å—Ç–∏
                </h5>
            </div>
            <div class="card-body">
                {% if frost_stats %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è –º–æ—Ä–æ–∑–æ—Å—Ç–æ–π–∫–æ—Å—Ç–∏</th>
                                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for stat in frost_stats %}
                            <tr>
                                <td>{{ stat.frost_category }}</td>
                                <td>{{ stat.count }}</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="progress flex-grow-1 me-2" style="height: 8px;">
                                            <div class="progress-bar bg-info"
                                                 style="width: {{ (stat.count / total * 100)|round(1) }}%">
                                            </div>
                                        </div>
                                        <span>{{ (stat.count / total * 100)|round(1) }}%</span>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-snowflake fa-3x text-muted mb-3"></i>
                    <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –º–æ—Ä–æ–∑–æ—Å—Ç–æ–π–∫–æ—Å—Ç–∏</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ä–æ–∫–∞–º —Å–æ–∑—Ä–µ–≤–∞–Ω–∏—è -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="fas fa-calendar-alt me-2 text-warning"></i>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ä–æ–∫–∞–º —Å–æ–∑—Ä–µ–≤–∞–Ω–∏—è
                </h5>
            </div>
            <div class="card-body">
                {% if ripening_stats %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–°—Ä–æ–∫ —Å–æ–∑—Ä–µ–≤–∞–Ω–∏—è</th>
                                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for stat in ripening_stats %}
                            <tr>
                                <td>{{ stat.ripening_category }}</td>
                                <td>{{ stat.count }}</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="progress flex-grow-1 me-2" style="height: 8px;">
                                            <div class="progress-bar bg-warning"
                                                 style="width: {{ (stat.count / total * 100)|round(1) }}%">
                                            </div>
                                        </div>
                                        <span>{{ (stat.count / total * 100)|round(1) }}%</span>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-calendar-alt fa-3x text-muted mb-3"></i>
                    <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å—Ä–æ–∫–∞—Ö —Å–æ–∑—Ä–µ–≤–∞–Ω–∏—è</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π -->
    <div class="col-12 mb-4">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="fas fa-chart-line me-2 text-danger"></i>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
                </h5>
            </div>
            <div class="card-body">
                {% if activity_stats %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π</th>
                                <th>–ì—Ä–∞—Ñ–∏–∫</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for stat in activity_stats %}
                            <tr>
                                <td>{{ stat.date }}</td>
                                <td>{{ stat.actions }}</td>
                                <td>
                                    <div class="progress" style="height: 20px;">
                                        {% set max_actions = activity_stats|map(attribute='actions')|max %}
                                        {% set width = (stat.actions / max_actions * 100) if max_actions > 0 else 0 %}
                                        <div class="progress-bar bg-danger"
                                             style="width: {{ width }}%"
                                             role="progressbar">
                                            {{ stat.actions }}
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
                    <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
<div class="alert alert-info mt-4">
    <h6 class="alert-heading text-dark">
        <i class="fas fa-info-circle me-2"></i>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
    </h6>
    <p class="mb-0 text-dark small">
        –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –î–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ.
    </p>
</div>
{% endblock %}
